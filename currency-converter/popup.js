(()=>{"use strict";const e={enabled:!0,baseCurrency:"CNY",displayFormat:"inline",decimalPlaces:2,showOriginalCurrency:!0,showExchangeRate:!0,language:"zh",enabledSites:[],disabledSites:[],useWhitelist:!1,autoUpdate:!0,updateInterval:60,maxElementsToScan:1e3,debounceDelay:300},t={zh:{appName:"æ±‡çŽ‡è½¬æ¢å™¨",appSubtitle:"å®žæ—¶è´§å¸è½¬æ¢åŠ©æ‰‹",controlTitle:"åŠŸèƒ½æŽ§åˆ¶",autoConvertLabel:"è‡ªåŠ¨è½¬æ¢",autoConvertDesc:"å¼€å¯åŽè‡ªåŠ¨è¯†åˆ«å¹¶è½¬æ¢é¡µé¢è´§å¸",settingsTitle:"è½¬æ¢è®¾ç½®",baseCurrencyLabel:"æœ¬åœ°è´§å¸",decimalPlacesLabel:"å°æ•°ä½æ•°",showRateLabel:"æ‚¬åœæ—¶æ˜¾ç¤ºæ±‡çŽ‡ä¿¡æ¯",currencyCNY:"ðŸ‡¨ðŸ‡³ äººæ°‘å¸ (CNY)",currencyUSD:"ðŸ‡ºðŸ‡¸ ç¾Žå…ƒ (USD)",currencyEUR:"ðŸ‡ªðŸ‡º æ¬§å…ƒ (EUR)",currencyGBP:"ðŸ‡¬ðŸ‡§ è‹±é•‘ (GBP)",currencyJPY:"ðŸ‡¯ðŸ‡µ æ—¥å…ƒ (JPY)",currencyKRW:"ðŸ‡°ðŸ‡· éŸ©å…ƒ (KRW)",currencyHKD:"ðŸ‡­ðŸ‡° æ¸¯å¸ (HKD)",statusTitle:"æ±‡çŽ‡çŠ¶æ€",statusLoading:"åŠ è½½ä¸­...",statusLatest:"æ±‡çŽ‡çŠ¶æ€: æœ€æ–°",statusExpired:"æ±‡çŽ‡çŠ¶æ€: å·²è¿‡æœŸ",statusNotCached:"æ±‡çŽ‡çŠ¶æ€: æœªç¼“å­˜",statusFailed:"æ±‡çŽ‡çŠ¶æ€: åŠ è½½å¤±è´¥",statusDesc:"æ±‡çŽ‡æ•°æ®æ¯å°æ—¶æ›´æ–°",clearCacheBtn:"æ¸…é™¤ç¼“å­˜",settingsSaved:"è®¾ç½®å·²è‡ªåŠ¨ä¿å­˜",settingsSaveFailed:"ä¿å­˜è®¾ç½®å¤±è´¥",cacheCleared:"ç¼“å­˜å·²æ¸…é™¤",cacheClearFailed:"æ¸…é™¤ç¼“å­˜å¤±è´¥",settingsLoadFailed:"åŠ è½½è®¾ç½®å¤±è´¥",convertedCount:"å·²è½¬æ¢",conversionDisabled:"è‡ªåŠ¨è½¬æ¢å·²ç¦ç”¨",fetchingRates:"æ­£åœ¨èŽ·å–æ±‡çŽ‡æ•°æ®...",fetchRatesFailed:"èŽ·å–æ±‡çŽ‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥",footerText:"æ•°æ®ç”± ExchangeRate-API æä¾›",rateInfo:"æ±‡çŽ‡",clickToConfig:"ç‚¹å‡»æ’ä»¶å›¾æ ‡å¯é…ç½®è®¾ç½®",minutesAgo:"åˆ†é’Ÿå‰æ›´æ–°",hoursAgo:"å°æ—¶å‰"},en:{appName:"Currency Converter",appSubtitle:"Real-time Currency Conversion Assistant",controlTitle:"Function Control",autoConvertLabel:"Auto Convert",autoConvertDesc:"Automatically detect and convert currencies on page",settingsTitle:"Conversion Settings",baseCurrencyLabel:"Base Currency",decimalPlacesLabel:"Decimal Places",showRateLabel:"Show exchange rate on hover",currencyCNY:"ðŸ‡¨ðŸ‡³ Chinese Yuan (CNY)",currencyUSD:"ðŸ‡ºðŸ‡¸ US Dollar (USD)",currencyEUR:"ðŸ‡ªðŸ‡º Euro (EUR)",currencyGBP:"ðŸ‡¬ðŸ‡§ British Pound (GBP)",currencyJPY:"ðŸ‡¯ðŸ‡µ Japanese Yen (JPY)",currencyKRW:"ðŸ‡°ðŸ‡· Korean Won (KRW)",currencyHKD:"ðŸ‡­ðŸ‡° Hong Kong Dollar (HKD)",statusTitle:"Exchange Rate Status",statusLoading:"Loading...",statusLatest:"Status: Latest",statusExpired:"Status: Expired",statusNotCached:"Status: Not Cached",statusFailed:"Status: Load Failed",statusDesc:"Exchange rates update hourly",clearCacheBtn:"Clear Cache",settingsSaved:"Settings saved automatically",settingsSaveFailed:"Failed to save settings",cacheCleared:"Cache cleared",cacheClearFailed:"Failed to clear cache",settingsLoadFailed:"Failed to load settings",convertedCount:"Converted",conversionDisabled:"Auto conversion disabled",fetchingRates:"Fetching exchange rates...",fetchRatesFailed:"Failed to fetch rates, please check network",footerText:"Data provided by ExchangeRate-API",rateInfo:"Rate",clickToConfig:"Click extension icon to configure",minutesAgo:"min ago",hoursAgo:"hr ago"}},a=new class{constructor(){this.currentLanguage="zh",this.loadLanguage()}async loadLanguage(){try{const e=await chrome.storage.local.get("language");this.currentLanguage=e.language||"zh"}catch(e){console.error("Failed to load language:",e)}}async setLanguage(e){this.currentLanguage=e;try{await chrome.storage.local.set({language:e})}catch(e){console.error("Failed to save language:",e)}}getLanguage(){return this.currentLanguage}t(e){return t[this.currentLanguage][e]}getMessages(){return t[this.currentLanguage]}};console.log("Currency Converter Extension: Popup loaded");let n=e;const s=document.getElementById("enabled"),c=document.getElementById("baseCurrency"),o=document.getElementById("decimalPlaces"),r=document.getElementById("showExchangeRate"),l=document.getElementById("statusText"),i=document.getElementById("clearCache"),u=document.getElementById("message"),g=document.getElementById("langBtn"),d=document.getElementById("langText");function h(){const e=a.getLanguage();d.textContent="zh"===e?"EN":"ä¸­æ–‡",document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=a.t(t))}),document.documentElement.lang="zh"===e?"zh-CN":"en"}async function C(){try{n={...n,enabled:s.checked,baseCurrency:c.value,decimalPlaces:parseInt(o.value),showExchangeRate:r.checked},await chrome.runtime.sendMessage({type:"UPDATE_SETTINGS",payload:{settings:n}}),m(a.t("settingsSaved"),"success")}catch(e){console.error("Failed to save settings:",e),m(a.t("settingsSaveFailed"),"error")}}async function y(){try{const e=`rateCache_${n.baseCurrency}`,t=(await chrome.storage.local.get(e))[e];if(t){const e=Date.now()-t.timestamp,n=Math.floor(e/6e4);if(e<36e5){const e=(a.getLanguage(),`(${n} ${a.t("minutesAgo")})`);l.textContent=`${a.t("statusLatest")} ${e}`}else{const e=Math.floor(n/60),t=(a.getLanguage(),`(${e} ${a.t("hoursAgo")})`);l.textContent=`${a.t("statusExpired")} ${t}`}}else l.textContent=a.t("statusNotCached")}catch(e){l.textContent=a.t("statusFailed")}}function m(e,t){u.textContent=e,u.className=`message ${t}`,u.classList.remove("hidden"),setTimeout(()=>{u.classList.add("hidden")},"success"===t?2e3:4e3)}s.addEventListener("change",C),c.addEventListener("change",()=>{C(),y()}),o.addEventListener("change",C),r.addEventListener("change",C),i.addEventListener("click",async function(){try{await chrome.runtime.sendMessage({type:"CLEAR_CACHE",payload:{}}),m(a.t("cacheCleared"),"success"),y()}catch(e){console.error("Failed to clear cache:",e),m(a.t("cacheClearFailed"),"error")}}),g.addEventListener("click",async function(){const e="zh"===a.getLanguage()?"en":"zh";await a.setLanguage(e),n.language=e,await chrome.storage.local.set({settings:n}),h(),y(),m(a.t("settingsSaved"),"success")}),async function(){await a.loadLanguage(),h()}().then(()=>{!async function(){try{const t=await chrome.storage.local.get("settings");n=t.settings||e,n.language&&(await a.setLanguage(n.language),h()),s.checked=n.enabled,c.value=n.baseCurrency,o.value=n.decimalPlaces.toString(),r.checked=n.showExchangeRate,y()}catch(e){console.error("Failed to load settings:",e),m(a.t("settingsLoadFailed"),"error")}}()})})();