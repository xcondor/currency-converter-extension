# 更新日志

## v1.0.1 - 2026-01-08

### 🐛 Bug 修复

- **修复了 ¥ 符号识别错误的问题**（重要修复）
  - 之前：半角 ¥ 被错误识别为日元（JPY），导致中文网站的人民币金额被转换
  - 现在：智能判断 ¥ 符号的含义，根据上下文自动识别是 CNY 还是 JPY
  - 判断逻辑：
    - 如果附近有"元"、"人民币"、"RMB"等中文标识 → CNY
    - 如果附近有"円"、"日元"等日文标识 → JPY
    - 如果上下文中有中文字符 → CNY（默认）
  - 结果：中文网站的 "¥100" 不再显示转换标签
  
- 优化了货币检测逻辑
  - 当检测到的货币与本地货币相同时，直接跳过转换
  - 添加了详细的调试日志，方便追踪货币识别过程
  - 提高了中文货币格式的识别置信度（0.85 → 0.95）

- 修复了部分金额无法识别的问题
  - 改进了元素选择算法，能够识别分散的货币结构
  - 例如：`<div><i>¥</i><span>699.<span>00</span></span></div>`
  - 智能选择包含完整货币信息的元素

- 去除了重复转换标签
  - 使用智能去重算法，避免同一价格显示多个标签
  - 优先保留包含货币符号的父元素

### 🎨 UI 优化

- 优化了转换标签的显示效果
  - 更小巧的标签设计（font-size: 0.85em）
  - 紧凑的内边距（padding: 2px 8px）
  - 半透明效果（opacity: 0.95）
  - 悬停时轻微放大效果

### 🔧 技术改进

- **移除了未使用的 notifications 权限**（Chrome Web Store 审核要求）
- 优化了权限使用，仅保留必需的权限：
  - `storage` - 保存用户设置和缓存汇率
  - `sidePanel` - 显示设置面板
  - `host_permissions` - 获取实时汇率数据

### 📝 文档更新

- 添加了 Chrome Web Store 重新提交指南
- 更新了权限使用说明
- 添加了详细的调试日志说明

## v1.0.0 - 2026-01-05

### ✨ 新功能

- 🎯 **自动货币转换** - 自动识别网页中的货币金额并显示转换结果
- 🔄 **启用/禁用开关** - 可随时控制插件是否自动转换（默认启用）
- 💱 **多货币支持** - 支持 USD, EUR, GBP, JPY, CNY, KRW, HKD 等主流货币
- 🎨 **美观的 UI** - 紫色渐变设计，现代化界面
- ⚡ **智能缓存** - 汇率数据缓存 1 小时，减少 API 调用
- 📊 **汇率状态显示** - 实时显示汇率更新状态

### 🎨 UI 优化

#### Popup 设置界面
- 紫色渐变背景，更加美观
- 卡片式布局，悬停效果
- 大号切换开关，操作更直观
- 优化的按钮样式和动画效果
- 成功/错误消息带动画提示

#### 页面转换标签
- 紫色渐变标签（`≈ 719.93 CNY`）
- 悬停放大效果
- 柔和的阴影和圆角
- 更好的字体和间距

#### 通知提示
- 滑入/滑出动画
- 紫色渐变背景
- 图标 + 文字组合
- 3 秒自动消失

### 🔧 技术特性

- TypeScript 开发，类型安全
- Chrome Extension Manifest V3
- 完整的单元测试和属性测试
- Webpack 打包优化
- ExchangeRate-API 实时汇率

### 📝 支持的货币格式

- 符号格式: $99.99, €50.00, £25.50, ¥1000
- ISO 代码: 1500 USD, EUR 250
- 中文格式: 100元, 500人民币
- 逗号分隔: $1,234.56

### 🎯 默认设置

- ✅ 启用自动转换
- 💴 本地货币: CNY (人民币)
- 📊 显示格式: 内联显示
- 🔢 小数位数: 2 位
- ✅ 显示原始货币
- ❌ 不显示汇率（可在设置中开启）

### 📦 安装说明

1. 下载或克隆项目
2. 运行 `npm install` 安装依赖
3. 运行 `npm run build` 构建插件
4. 在 Chrome 中加载 `dist` 目录

### 🐛 已知问题

- 动态加载的内容需要刷新页面才能检测
- 某些网站的特殊布局可能影响显示效果

### 🔮 未来计划

- [ ] 支持 MutationObserver 监听动态内容
- [ ] 添加更多货币支持
- [ ] 支持自定义转换标签样式
- [ ] 添加网站白名单/黑名单功能
- [ ] 支持快捷键控制
